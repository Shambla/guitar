<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link type="text/css" rel="stylesheet" href="style/montserrat.css">
		<link type="text/css" rel="stylesheet" href="style/font-awesome.css">
		<link type="text/css" rel="stylesheet" href="style/index.css">
		<link rel="shortcut icon" href="img/favico.ico" type="image/x-icon">
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="script/index.js"></script>
		<script type="text/javascript" src="script/iframetracker.js"></script>
		<script type="text/javascript" src="https://apis.google.com/js/client.js?onload=loadYoutube"></script>
		<title>Brian Streckfus</title>
	</head>
	<body>
		<nav>
			<div id="backing"></div>
			<div class="content">
				<a href="catalog.html" class="catalog-nav-link">&#128220; &#127925; &#128722; CATALOG &#127911; &#127925; &#127928;</a>
				<!-- TODO: Add SHOP link when Stripe is set up -->
				<!-- <a href="shop.html">&#128722; SHOP</a> -->
				<a href="#media">&#128247; &#9654; MEDIA</a>
				<a href="#bio">&#128100; BIO</a>
				<a href="#performances">&#127908; PERFORMANCES</a>
				<a href="signals.html">ðŸ’¹  Trading Signals</a>
				<a href="#contact">&#128236; CONTACT</a>
				<div id="music-container">
					<div id="music">
						<div class="bar"></div>
						<div class="bar"></div>
						<div class="bar"></div>
						<div class="bar"></div>
						<div class="bar"></div>
						<div id="paused">[paused]</div>
					</div>
					<span id="track">Gran Vals [Nokia Tune]</span>
				</div>
			</div>
		</nav>
		<div>
		</div>
		<div id="hero">
			<div class="content">
				<h1>Brian Streckfus</h1>
				<div id="creds">
					<h3 id="teacher">Teacher</h3>
					<h3 id="arranger">Arranger</h3>
					<h3 id="performer">Performer</h3>
					<h3 id="content-creator">Content Creator</h3>
				</div>
				<!-- Add the panoramic photo here -->
				<!-- <img id="panoramic-photo" src="img/Pano_Studio.jpg" alt="Panoramic View" style="width: 100%; height: auto;"/> -->
			</div>
		</div>
		<div class="content">
			<!-- Mailing List Offer (top-of-page, no popup) -->
			<div class="fade-in-up" style="margin-top: 30px; margin-bottom: 50px; padding: 24px; background: rgba(0, 0, 0, 0.35); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.6);">
				<h2 style="color: #fff; margin: 0 0 10px 0; font-size: 28px; display: flex; align-items: center; gap: 10px;">
					<i class='fa fa-envelope-o' style="font-size: 22px;"></i>
					Get the free Guitar Scales PDF + a soothing lydian backing track
				</h2>
				<p style="color: rgba(255, 255, 255, 0.9); font-size: 15px; margin: 0 0 14px 0; line-height: 1.6;">
					I focus on low-hanging fruit, things that passively compound ðŸŒ³, so I can spend more time doing what I love. Join the mailing list and Iâ€™ll send you a free guitar scales PDF and a free soothing lydian backing track as a token of my appreciation.
					Every two months youâ€™ll also get occasional updates about discounts, new sheet music & TAB, new music resources, MP3 releases, and new YouTube uploads. I also give away a free 7 day trial to my trading signals.
				</p>
				<form class="email-list-form" action="https://usebasin.com/f/7c55ae649861" method="POST" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
					<input
						type="email"
						name="email"
						placeholder="Enter your email address"
						required
						style="flex: 1; min-width: 240px; padding: 12px 15px; border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 6px; background: rgba(255, 255, 255, 0.12); color: #fff; font-size: 14px; outline: none; transition: all 0.3s ease;"
						onfocus="this.style.borderColor='rgba(255, 255, 255, 0.8)'; this.style.background='rgba(255, 255, 255, 0.18)';"
						onblur="this.style.borderColor='rgba(255, 255, 255, 0.6)'; this.style.background='rgba(255, 255, 255, 0.12)';"
					/>
					<button
						type="submit"
						class="email-list-submit"
						style="padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 6px; color: #fff; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;"
						onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';"
						onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
					>
						Get the freebies
					</button>
				</form>
				<div class="email-list-message" style="margin-top: 10px; font-size: 14px; min-height: 20px;"></div>
				<div style="margin-top: 10px; color: rgba(255, 255, 255, 0.75); font-size: 12px;">
					No spam. Unsubscribe anytime.
				</div>
			</div>

			<div>
				<h1 id="media" class="fade-in-up">Media</h1>
				<div class="left-half fade-in-left">
					<p class="fade-in-up">Features of my music arrangements and method books:</p>
					<ul style="list-style: none; padding-left: 0;">
						<li class="fade-in-up">&#127925; Playable and intuitive music theory</li>
						<li class="fade-in-up">&#127928; Practical library of chords & scales</li>
						<li class="fade-in-up">&#127926; Chord names and chord diagrams</li>
						<li class="fade-in-up">&#127928; Letter names inside noteheads to aid sight-reading</li>
						<li class="fade-in-up">&#9995; Obvious fingerings done for you, saving countless hours</li>
						<li class="fade-in-up">&#127930; Jazz lead sheet styling; short and practical for gigs</li>
						<li class="fade-in-up">&#127931; Ensembles arranged for solo guitar</li>
						<li class="fade-in-up">&#127928; Guitar tablature with rhythms &#127926;</li>
						<li class="fade-in-up">&#127908; Clear phrasing through thoughtful engraving</li>
						<li class="fade-in-up">&#11088; Arrangments of popular titles by The Beatles, Morgan Wallen, Taylor Swift, Fleetwood Mac, Nirvana, No Doubt, Red Hot Chili Peppers and more!</li>
					</ul>
					<p class="fade-in-up animate-delay-4">
					My publications are designed for hobbyists and professionals alike to play with clarity quickly, while remaining sophisticated 
					enough for professional analysis. This bridges the gap for millions of guitarists seeking more 
					efficient learning materials. Reading sheet music really isn't required, but it's there for analysis if it benefits you.</p>
					<!-- Add impressionist vague sheet music photo here-->
					<a class="link-button fade-in-up animate-delay-5" href="chopin-Waltz-No-2.pdf">&#128220; View Sample</a>
					<a class="link-button fade-in-up animate-delay-5" href="catalog.html">&#127925; Browse Sheet Music Catalog &#128220;</a>
					<a class="link-button fade-in-up animate-delay-5" href="https://www.sheetmusicdirect.com/en-US/Search.aspx?query=Brian%2BStreckfus" target="_blank" style="margin-right: 15px;">Directly go to SheetMusicDirect.com</a>
					<a class="link-button fade-in-up animate-delay-5" href="https://belairmusicstudios.opus1.io/w/trial" target="_blank">&#128197; Schedule Free Online Trial Music Lesson &#127925;</a>
				</div>
				<div class="right-half fade-in-right">
					<img id="sheet" src="img/sheet.png" style="max-width: 100%; height: auto; margin-top: -40px; margin-left: -40px;" class="scale-in"/>
				</div>
				<div style="clear: both"></div>
				<!-- New Youtube attempt to fix 2025-->
				<div class="left-half fade-in-left">
					<h3 class="fade-in-up">Music Videos (Free!)</h3>
					<iframe width="560" height="315" src="https://www.youtube.com/embed/6TvW0k3H9Fw" frameborder="0" allowfullscreen class="scale-in animate-delay-2" style="max-width: 100%; height: auto; aspect-ratio: 16/9;"></iframe>
				</div>
				<div class="right-half fade-in-right">
					<h3 class="fade-in-up">Peabody Performances (Free!)</h3>
					<iframe width="560" height="315" src="https://www.youtube.com/embed/nYwXDXWV0KM" frameborder="0" allowfullscreen class="scale-in animate-delay-3" style="max-width: 100%; height: auto; aspect-ratio: 16/9;"></iframe>
				</div>
				<div style="clear: both"></div>
				<div class="left-half fade-in-left">
					<h3 class="fade-in-up">Intuitive HQ Backing Tracks (Free!)</h3>
					<iframe width="560" height="315" src="https://www.youtube.com/embed/WlOBMEsUVQc" frameborder="0" allowfullscreen class="scale-in animate-delay-4" style="max-width: 100%; height: auto; aspect-ratio: 16/9;"></iframe>
				</div>
				<div class="right-half fade-in-right">
					<h3 class="fade-in-up">Sheet Music & TAB Scroll Videos (Free!)</h3>
					<iframe width="560" height="315" src="https://www.youtube.com/embed/wpZFU5QmZY8" frameborder="0" allowfullscreen class="scale-in animate-delay-5" style="max-width: 100%; height: auto; aspect-ratio: 16/9;"></iframe>
				</div>
				<div style="clear: both"></div>
				<!-- TODO - Fix Youtube links DONE
				!-- TODO - Add Bel Air Music Studios 
				!-- TODO - Add Sheetmusicdirect link www.sheetmusicdirect.com/en-US/Search.aspx?query=Brian%2BStreckfus 
				-->
			
			</div>
			<h1 id="bio" class="fade-in-up">Bio</h1>
			<div id="bio-section-wrapper" style="position: relative; width: 100%; display: flex; gap: 30px; align-items: flex-start; margin-bottom: 40px;">
				<!-- Studio Comp on the left - larger, with potential text overlay -->
				<div id="studio-comp-container" class="fade-in-left" style="position: relative; flex: 1; min-width: 0;">
					<img id="desk-pic" src="img/Studio_Comp.png" class="scale-in" style="width: 100%; max-width: 1000px; height: auto; display: block;"/>
					<!-- Dark overlay that can be controlled by hover -->
					<div id="image-dark-overlay"></div>
					<!-- Text overlay area - can be positioned over image if needed -->
					<div id="bio-text-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: auto; z-index: 1; overflow: visible;">
						<div style="position: relative; height: 100%; padding: 20px; padding-bottom: 120px; display: flex; flex-direction: column; justify-content: flex-start;">
							<p class="bio-text-paragraph fade-in-up animate-delay-1">
								Brian Streckfus holds a Bachelor's degree from Peabody Conservatory and a Master's from Towson University, 
								where he received assistantship and scholarship awards. He has taught guitar for over a decade at 
								Bel Air Music Studios and has over 150 publications with Hal Leonard. His former teachers include 
								Ray Chester, the former chair of guitar at Peabody Conservatory, and other notable Maryland guitarists 
								including James Hontz, Ph.D., Troy King, Brian Kooken, and Vincent Corson.
							</p>
							<p class="bio-text-paragraph fade-in-up animate-delay-2">
								Brian has performed jazz, classical, and popular music at venues throughout Maryland, including 
								PRISM: A Musical Collage at Kaplan Concert Hallâ€”a fast-paced, continuous performance featuring 
								dramatic lighting and multiple ensembles. He has participated in masterclasses with world-renowned 
								guitarists Meng Su and Irina Kulikova, and has been a guitarist in the band Intuitive Minds United 
								for over a decade.
							</p>
							<p class="bio-text-paragraph fade-in-up animate-delay-3">
								Brian operates a home recording studio and has produced over a hundred videos with hundreds of thousands 
								of views. His extensive formal training, combined with an undogmatic jazz-classical approach, diverse 
								repertoire, and expertise in audio/video production make him an exceptional instructor and performer.
							</p>
							<a class="link-button fade-in-up animate-delay-4" href="Brian Streckfus-Resume.pdf" style="margin-top: 10px; margin-bottom: 0;">&#128220; View Resume</a>
						</div>
					</div>
				</div>
				<!-- Bio pic on the right -->
				<div id="bio-pic-container" class="fade-in-right" style="flex: 0 0 auto; min-width: 0;">
					<img id="bio-pic" src="img/bio.png" class="scale-in" style="width: 100%; max-width: 600px; height: auto; display: block;"/>
				</div>
			</div>
			<!-- Alternative: Text below images if overlay doesn't work well -->
			<div id="bio-text-below" class="left-half fade-in-left" style="display: none;">
				<p class="fade-in-up animate-delay-1">
					Brian Streckfus holds a Bachelor's degree from Peabody Conservatory and a Master's from Towson University, 
					where he received assistantship and scholarship awards. He has taught guitar for over a decade at 
					Bel Air Music Studios and has over 150 publications with Hal Leonard. His former teachers include 
					Ray Chester, the former chair of guitar at Peabody Conservatory, and other notable Maryland guitarists 
					including James Hontz, Ph.D., Troy King, Brian Kooken, and Vincent Corson.
				</p>
				<p class="fade-in-up animate-delay-2">
					Brian has performed jazz, classical, and popular music at venues throughout Maryland, including 
					PRISM: A Musical Collage at Kaplan Concert Hallâ€”a fast-paced, continuous performance featuring 
					dramatic lighting and multiple ensembles. He has participated in masterclasses with world-renowned 
					guitarists Meng Su and Irina Kulikova, and has been a guitarist in the band Intuitive Minds United 
					for over a decade.
				</p>
				<p class="fade-in-up animate-delay-3">
					Brian operates a home recording studio and has produced over a hundred videos with hundreds of thousands 
					of views. His extensive formal training, combined with an undogmatic jazz / classical / pop approach, diverse 
					repertoire, and expertise in audio/video production make him an exceptional instructor and performer.
				</p>
				<a class="link-button fade-in-up animate-delay-4" href="Brian Streckfus-Resume.pdf">&#128220; View Resume</a>
			</div>
			<div style="clear: both"></div>
			<div class="right">
				<h1 id="performances" class="fade-in-up">Performances</h1>
				<div style="clear: both"></div>
				<div class="left-half fade-in-left">
					<!-- <img id="perform" src="img/perform.png"/> -->
					<img id="perform" src="img/perform.png" style="max-width: 100%; height: auto; margin-top: -40px; margin-left: -40px;" class="scale-in"/>
				</div>
				<div id="performance-details" class="right-half fade-in-right">
					<h3 class="fade-in-up">Notable Solo Performances</h3>
					<p class="fade-in-up animate-delay-1">Solo Guitar Recital, Fallston Hall, Bel Air, MD. 2009</p>
					<span class="fade-in-up animate-delay-1">Works by: J.S. Bach</span>
					<p class="fade-in-up animate-delay-2">Solo Guitar Recital, Cohen-Davison Family Theatre, Baltimore, MD. 2014</p>
					<span class="fade-in-up animate-delay-2">Works by: Milan, J. S. Bach, Tarrega, Ponce</span>
					<p class="fade-in-up animate-delay-3">Solo Guitar Recital, Cohen-Davison Family Theatre, Baltimore, MD. 2015</p>
					<span class="fade-in-up animate-delay-3">Works by: Milan, J. S. Bach, Tarrega, Ponce, Villa-Lobos</span>
					<h3 class="fade-in-up animate-delay-4">Chamber Music Performances</h3>
					<p class="fade-in-up animate-delay-4">Classical Guitar Quartet, Kaplan Hall, Towson, MD. 2007</p>
					<span class="fade-in-up animate-delay-4">Works by: Torroba and Tedesco</span>
					<p class="fade-in-up animate-delay-5">Classical Guitar Duo, Andie Musik, Baltimore, MD. 2008</p>
					<span class="fade-in-up animate-delay-5">Works by: W. A. Mozart</span>
					<p class="fade-in-up animate-delay-5">Classical Guitar Trio, Goodwin Hall (Fret-Fest) Baltimore, MD. 2012</p>
					<span class="fade-in-up animate-delay-5">Works by: J. F. Handel</span>
					<h3 class="fade-in-up animate-delay-5">Large Ensemble Experience</h3>
					<p class="fade-in-up animate-delay-5">Bass Section Singer, Peabody/Hopkins Chorus, Baltimore, MD 2011-2013</p>
					<span class="fade-in-up animate-delay-5">Works by: Carl Orff, Leonard Bernstein, Franz Schubert, Guiseppe Verdi</span>
					<p class="fade-in-up animate-delay-5">Guitarist, Harford Community College Jazz Big Band, Fallston Hall, Bel Air, MC 2007-2009</p>
					<span class="fade-in-up animate-delay-5">Jazz standards such as: Autumn Leaves, Anthropology, Maiden Voyage, Lush Life</span>
					<br/>
					<a class="link-button fade-in-up animate-delay-5" href="https://www.gigsalad.com/intuitive_minds_united_aberdeen">Book a Gig</a>
				</div>
				<div style="clear: both"></div>
			</div>
			<div class="right" style="position: relative;">
				<img id="contact-pic" src="img/contact.png" class="scale-in"/>
				<div id="contact-details" class="right-half fade-in-right" style="position: relative; z-index: 2;">
					<h1 id="contact" class="fade-in-up">Contact</h1>
					<p class="fade-in-up animate-delay-1">Whether you're interested in online lessons, booking an event, or looking to collaborate, drop me a line! 
					<div class="contacts">
						<div>
							<div class="contact fade-in-up">
								<i class='fa fa-link'></i>
								<h3>All Links</h3>
								<a href="https://allmylinks.com/brianstreckfus">allmylinks.com/brianstreckfus</a>
								<div style="clear: both"></div>				
							</div>
							<div class="contact fade-in-up animate-delay-1">
								<i class='fa fa-envelope'></i>
								<h3>Email</h3>
								<span id="addy"></span>	
								<div style="clear: both"></div>			
							</div>
							<div class="contact fade-in-up animate-delay-2">
								<i class='fa fa-youtube'></i>
								<h3>YouTube</h3>
								<a href="https://www.youtube.com/user/WoodenBoxEngineer">youtube.com/user/WoodenBoxEngineer</a>
								<div style="clear: both"></div>						
							</div>
							<div class="contact fade-in-up animate-delay-3">
								<i class='fa fa-linkedin-square'></i>
								<h3>LinkedIn</h3>
								<a href="https://www.linkedin.com/in/brian-streckfus-9b334a92">linkedin.com/in/brian-streckfus-9b334a92</a>
								<div style="clear: both"></div>						
							</div>
						</div>
						<div>
							<div class="contact fade-in-up animate-delay-1">
								<i class='fa fa-twitter'></i>
								<h3>Twitter</h3>
								<a href="https://twitter.com/BrianStreckfus">twitter.com/BrianStreckfus</a>
								<div style="clear: both"></div>				
							</div>
							<div class="contact fade-in-up animate-delay-2">
								<i class='fa fa-facebook'></i>
								<h3>Facebook</h3>
								<a href="https://www.facebook.com/profile.php?id=100078682133421">facebook.com/profile.php?id=100078682133421</a>
								<div style="clear: both"></div>			
							</div>
							<div class="contact fade-in-up animate-delay-3">
								<i class='fa fa-instagram'></i>
								<h3>Instagram</h3>
								<a href="https://www.instagram.com/brianstreckfus/">instagram.com/brianstreckfus/</a>
								<div style="clear: both"></div>
												<!-- TODO - Fix Youtube links DONE
											</div>
							<div class="contact">
								<i class='fa fa-soundcloud'></i>
								<h3>Soundcloud</h3>
								<a href="https://soundcloud.com/streckfusclassicalguitar">soundcloud.com/streckfusclassicalguitar</a>
								<div style="clear: both"></div>		
				!-- TODO - Add Sheetmusicdirect link www.sheetmusicdirect.com/en-US/Search.aspx?query=Brian%2BStreckfus 
				-->						
							</div>
							<div class="contact fade-in-up animate-delay-4">
								<i class='fa fa-music'></i>
								<h3>Music Publications</h3>
								<a href="www.sheetmusicdirect.com/en-US/Search.aspx?query=Brian%2BStreckfus"> sheetmusicdirect.com/en-US/Search.aspx?query=Brian%2BStreckfus</a>
								<div style="clear: both"></div>						
							</div>
						</div>
					</div>
					<!-- Email List Signup -->
					<div class="email-list-signup fade-in-up animate-delay-5" style="margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1);">
						<h3 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
							<i class='fa fa-envelope-o' style="font-size: 20px;"></i>
							Join Our Email List
						</h3>
						<p style="color: rgba(255, 255, 255, 0.8); font-size: 14px; margin-bottom: 15px;">
							Join the mailing list and get a free guitar scales PDF + a free soothing Lydian backing track as a token of my appreciation.
							Youâ€™ll also get occasional updates about new sheet music, MP3 releases, and new YouTube uploads.
						</p>
						<form class="email-list-form" action="https://usebasin.com/f/7c55ae649861" method="POST" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
							<input 
								type="email" 
								name="email"
								placeholder="Enter your email address" 
								required
								style="flex: 1; min-width: 200px; padding: 12px 15px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #fff; font-size: 14px; outline: none; transition: all 0.3s ease;"
								onfocus="this.style.borderColor='rgba(255, 255, 255, 0.6)'; this.style.background='rgba(255, 255, 255, 0.15)';"
								onblur="this.style.borderColor='rgba(255, 255, 255, 0.3)'; this.style.background='rgba(255, 255, 255, 0.1)';"
							/>
							<button 
								type="submit" 
								class="email-list-submit"
								style="padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 6px; color: #fff; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;"
								onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';"
								onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
							>
								Subscribe
							</button>
						</form>
						<div class="email-list-message" style="margin-top: 10px; font-size: 14px; min-height: 20px;"></div>
					</div>
				</div>
			</div>
		</div>
		<footer class="fade-in" style="text-align: center; padding: 40px 20px; margin-top: 60px; background: #f5f5f5; border-top: 1px solid #ddd;">
			<p>&copy; 2024 Brian Streckfus</p>
		</footer>
		<audio autoplay loop>
			<source src="audio/audio2.mp3" type="audio/mpeg"/>
		</audio>
		<script>
			// Email List Signup Handler
			(function() {
				// API endpoint configuration
				// - Local dev: use localhost server (run: python3 email_list_server.py --port 5007)
				// - Production (S3/CloudFront): use a form backend service (Basin endpoint below)
				//   Basin stores submissions privately + can email you notifications.
				const BASIN_ENDPOINT = 'https://usebasin.com/f/7c55ae649861';
				const API_ENDPOINT = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
					? 'http://localhost:5007/api/subscribe'
					: BASIN_ENDPOINT;
				
				// Handle form submission(s)
				const forms = Array.from(document.querySelectorAll('form.email-list-form'));

				function wireUpForm(form) {
					if (!form) return;

					const input = form.querySelector('input[name="email"]');
					const messageDiv = form.parentElement ? form.parentElement.querySelector('.email-list-message') : null;
					const submitButton = form.querySelector('.email-list-submit') || form.querySelector('button[type="submit"]');

					if (!input) return;

					form.addEventListener('submit', async function(e) {
						e.preventDefault();
						
						const email = (input.value || '').trim();
						
						if (!email) {
							showMessage(messageDiv, 'Please enter a valid email address.', 'error');
							return;
						}
						
						// Basic email validation
						const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
						if (!emailRegex.test(email)) {
							showMessage(messageDiv, 'Please enter a valid email address.', 'error');
							return;
						}
						
						// Disable button and show loading state
						if (submitButton) {
							submitButton.disabled = true;
							submitButton.dataset.prevText = submitButton.textContent || '';
							submitButton.textContent = 'Subscribing...';
						}
						
						try {
							// Local Flask server expects JSON. Basin expects a standard form POST.
							if (API_ENDPOINT === BASIN_ENDPOINT) {
								const fd = new FormData();
								fd.append('email', email);
								fd.append('source', location.href);
								fd.append('ts', new Date().toISOString());

								const response = await fetch(API_ENDPOINT, {
									method: 'POST',
									headers: {
										'Accept': 'application/json'
									},
									body: fd
								});

								if (response.ok) {
									showMessage(messageDiv, 'âœ“ Thank you! Check your email for the freebies.', 'success');
									input.value = '';
								} else {
									let serverText = '';
									try { serverText = await response.text(); } catch (_) {}
									console.error('Basin error response:', response.status, serverText);
									showMessage(messageDiv, 'Something went wrong. Please try again.', 'error');
								}
							} else {
								// Send email to local backend API (JSON)
								const response = await fetch(API_ENDPOINT, {
									method: 'POST',
									headers: {
										'Content-Type': 'application/json',
									},
									body: JSON.stringify({ email: email })
								});

								const data = await response.json();

								if (data.success) {
									if (data.already_subscribed) {
										showMessage(messageDiv, 'You\'re already subscribed! Thank you.', 'info');
									} else {
										showMessage(messageDiv, 'âœ“ Thank you! You\'ve been added to our email list.', 'success');
										input.value = ''; // Clear input
										console.log('New email subscriber:', email);
										if (data.total_subscribers) {
											console.log('Total subscribers:', data.total_subscribers);
										}
									}
								} else {
									showMessage(messageDiv, data.error || 'Something went wrong. Please try again.', 'error');
								}
							}
						} catch (error) {
							console.error('Error subscribing:', error);
							console.error('API endpoint attempted:', API_ENDPOINT);
							// More detailed error message for debugging
							const errorMsg = error.message || 'Unable to connect to server. Please try again later.';
							// If Basin fetch is blocked by CORS or extensions, fall back to a normal form POST
							// (This will navigate away, but it will reliably submit.)
							if (API_ENDPOINT === BASIN_ENDPOINT && form) {
								try {
									form.action = BASIN_ENDPOINT;
									form.method = 'POST';
									showMessage(messageDiv, 'Submittingâ€¦', 'info');
									form.submit();
									return;
								} catch (_) {}
							}
							showMessage(messageDiv, 'Unable to connect to server. Please try again later.', 'error');
						} finally {
							// Re-enable button
							if (submitButton) {
								submitButton.disabled = false;
								const prev = submitButton.dataset.prevText || 'Subscribe';
								submitButton.textContent = prev;
							}
						}
					});
				}

				forms.forEach(wireUpForm);
				
				// Show message to user
				function showMessage(messageDiv, text, type) {
					if (!messageDiv) return;
					
					messageDiv.textContent = text;
					messageDiv.style.color = type === 'success' ? '#4caf50' : 
					                          type === 'error' ? '#f44336' : 
					                          'rgba(255, 255, 255, 0.8)';
					messageDiv.style.fontWeight = type === 'success' ? 'bold' : 'normal';
					
					// Clear message after 5 seconds
					setTimeout(function() {
						if (messageDiv.textContent === text) {
							messageDiv.textContent = '';
						}
					}, 5000);
				}
			})();
		</script>

		<!-- Trading Assistant Chat Widget -->
		<style>
			#chatFab {
				position: fixed;
				right: 20px;
				bottom: 20px;
				z-index: 9999;
				width: 60px;
				height: 60px;
				border-radius: 50%;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				border: none;
				color: #fff;
				font-size: 24px;
				cursor: pointer;
				box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
				transition: all 0.3s ease;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			#chatFab:hover {
				transform: translateY(-2px);
				box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
			}
			#chatBox {
				position: fixed;
				right: 20px;
				bottom: 90px;
				z-index: 9998;
				width: 380px;
				max-width: calc(100vw - 40px);
				height: 500px;
				max-height: calc(100vh - 120px);
				background: rgba(0, 0, 0, 0.95);
				border: 1px solid rgba(255, 255, 255, 0.3);
				border-radius: 12px;
				display: none;
				flex-direction: column;
				overflow: hidden;
				box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
			}
			#chatBox.open {
				display: flex;
			}
			#chatHeader {
				padding: 15px 18px;
				border-bottom: 1px solid rgba(255, 255, 255, 0.2);
				display: flex;
				align-items: center;
				justify-content: space-between;
				background: rgba(102, 126, 234, 0.1);
			}
			#chatHeader h3 {
				margin: 0;
				color: #fff;
				font-size: 18px;
				font-weight: 600;
			}
			#chatClose {
				background: rgba(255, 255, 255, 0.15);
				border: 1px solid rgba(255, 255, 255, 0.3);
				border-radius: 6px;
				color: #fff;
				padding: 6px 12px;
				cursor: pointer;
				font-size: 14px;
				transition: all 0.3s ease;
			}
			#chatClose:hover {
				background: rgba(255, 255, 255, 0.25);
			}
			#chatMsgs {
				flex: 1;
				padding: 15px 18px;
				overflow-y: auto;
				overflow-x: hidden;
				font-size: 14px;
				line-height: 1.6;
			}
			#chatMsgs::-webkit-scrollbar {
				width: 6px;
			}
			#chatMsgs::-webkit-scrollbar-track {
				background: rgba(255, 255, 255, 0.05);
			}
			#chatMsgs::-webkit-scrollbar-thumb {
				background: rgba(255, 255, 255, 0.2);
				border-radius: 3px;
			}
			.chat-msg {
				margin: 12px 0;
				padding: 10px 12px;
				border-radius: 8px;
				word-wrap: break-word;
				white-space: pre-wrap;
			}
			.chat-msg.user {
				background: rgba(102, 126, 234, 0.2);
				border-left: 3px solid #667eea;
				color: rgba(255, 255, 255, 0.95);
				margin-left: 20px;
			}
			.chat-msg.assistant {
				background: rgba(255, 255, 255, 0.08);
				border-left: 3px solid rgba(255, 255, 255, 0.4);
				color: rgba(255, 255, 255, 0.9);
				margin-right: 20px;
			}
			.chat-msg.error {
				background: rgba(244, 67, 54, 0.2);
				border-left: 3px solid #f44336;
				color: rgba(255, 255, 255, 0.9);
			}
			.chat-msg.loading {
				color: rgba(255, 255, 255, 0.6);
				font-style: italic;
			}
			#chatForm {
				padding: 15px 18px;
				border-top: 1px solid rgba(255, 255, 255, 0.2);
				display: flex;
				gap: 10px;
				background: rgba(0, 0, 0, 0.3);
			}
			#chatInput {
				flex: 1;
				padding: 10px 14px;
				border: 1px solid rgba(255, 255, 255, 0.3);
				border-radius: 6px;
				background: rgba(255, 255, 255, 0.1);
				color: #fff;
				font-size: 14px;
				outline: none;
				transition: all 0.3s ease;
			}
			#chatInput:focus {
				border-color: rgba(255, 255, 255, 0.6);
				background: rgba(255, 255, 255, 0.15);
			}
			#chatInput::placeholder {
				color: rgba(255, 255, 255, 0.5);
			}
			#chatSend {
				padding: 10px 20px;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				border: none;
				border-radius: 6px;
				color: #fff;
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				white-space: nowrap;
			}
			#chatSend:hover:not(:disabled) {
				transform: translateY(-1px);
				box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
			}
			#chatSend:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}
			#chatPrompts {
				padding: 10px 18px;
				border-bottom: 1px solid rgba(255, 255, 255, 0.1);
				display: flex;
				flex-direction: column;
				gap: 8px;
			}
			#chatPrompts.hidden {
				display: none;
			}
			.chat-prompt {
				padding: 10px 14px;
				background: rgba(102, 126, 234, 0.15);
				border: 1px solid rgba(102, 126, 234, 0.3);
				border-radius: 6px;
				color: rgba(255, 255, 255, 0.9);
				font-size: 13px;
				cursor: pointer;
				transition: all 0.3s ease;
				text-align: left;
			}
			.chat-prompt:hover {
				background: rgba(102, 126, 234, 0.25);
				border-color: rgba(102, 126, 234, 0.5);
				transform: translateX(4px);
			}
			@media (max-width: 480px) {
				#chatBox {
					width: calc(100vw - 20px);
					right: 10px;
					bottom: 80px;
					height: calc(100vh - 100px);
				}
				#chatFab {
					right: 10px;
					bottom: 10px;
				}
			}
		</style>

		<button id="chatFab" type="button" aria-label="Open Assistant Chat" title="Assistant">
			ðŸ’¬
		</button>

		<div id="chatBox" role="dialog" aria-label="Assistant Chat">
			<div id="chatHeader">
				<h3>ðŸ’¬ Assistant</h3>
				<button id="chatClose" type="button">Close</button>
			</div>
			<div id="chatMsgs">
				<div class="chat-msg assistant">
					Hello, I am your assistant on this website. I am programmed to be especially good at answering finance and music questions, using context from this website.
				</div>
			</div>
			<div id="chatPrompts">
				<div class="chat-prompt">What are today's top 3 buys and top sells?</div>
				<div class="chat-prompt">Do you have an arrangement of this song?</div>
				<div class="chat-prompt">What is a moving average crossover strategy?</div>
				<div class="chat-prompt">What guitar techniques are used in jazz?</div>
			</div>
			<form id="chatForm">
				<input id="chatInput" type="text" autocomplete="off" placeholder="Ask a question..." />
				<button id="chatSend" type="submit">Send</button>
			</form>
		</div>

		<script>
			(function() {
				const WORKER_ENDPOINT = 'https://trading-assistant.brianstreckfus.workers.dev/chat';
				const fab = document.getElementById('chatFab');
				const box = document.getElementById('chatBox');
				const closeBtn = document.getElementById('chatClose');
				const form = document.getElementById('chatForm');
				const input = document.getElementById('chatInput');
				const msgs = document.getElementById('chatMsgs');
				const sendBtn = document.getElementById('chatSend');
				const prompts = document.getElementById('chatPrompts');

				// Generate a session ID (persists for this browser session)
				let sessionId = sessionStorage.getItem('trading_assistant_session_id');
				if (!sessionId) {
					sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
					sessionStorage.setItem('trading_assistant_session_id', sessionId);
				}

				function addMsg(text, type = 'assistant') {
					const div = document.createElement('div');
					div.className = 'chat-msg ' + type;
					div.textContent = text;
					msgs.appendChild(div);
					msgs.scrollTop = msgs.scrollHeight;
				}

				function scrollToBottom() {
					msgs.scrollTop = msgs.scrollHeight;
				}

				fab.onclick = function() {
					box.classList.add('open');
					input.focus();
					scrollToBottom();
				};

				closeBtn.onclick = function() {
					box.classList.remove('open');
				};

				// Handle example prompt clicks
				const promptButtons = prompts.querySelectorAll('.chat-prompt');
				promptButtons.forEach(function(btn) {
					btn.onclick = function() {
						const promptText = btn.textContent.trim();
						input.value = promptText;
						input.focus();
						// Auto-submit the prompt
						form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
					};
				});

				// Helper: Fetch top 3 buys and sells from signals.json
				async function fetchTopSignals() {
					try {
						const response = await fetch('signals/signals.json');
						if (!response.ok) throw new Error('Failed to fetch signals');
						const signals = await response.json();
						
						// Filter stock signals only
						const stockSignals = signals.filter(s => {
							const symbol = (s.symbol || '').toUpperCase();
							return !symbol.includes('/USD') && !symbol.includes('/USDT') && symbol.length <= 5;
						});
						
						// Calculate scores (same logic as signals.html)
						const BUY_THRESHOLD = 16;
						const SELL_THRESHOLD = 13;
						
						const signalsWithScores = stockSignals.map(s => {
							let buyScore = s.buy_score || 0;
							let sellScore = s.sell_score || 0;
							const note = s.note || '';
							const buyMatch = note.match(/buy\s+(\d+)\/(\d+)/i);
							const sellMatch = note.match(/sell\s+(\d+)\/(\d+)/i);
							if (buyMatch) buyScore = parseInt(buyMatch[1]);
							if (sellMatch) sellScore = parseInt(sellMatch[1]);
							
							return {
								...s,
								buyScore: buyScore,
								sellScore: sellScore,
								totalBuy: buyMatch ? parseInt(buyMatch[2]) : 38,
								totalSell: sellMatch ? parseInt(sellMatch[2]) : 37
							};
						});
						
						// Get top 3 buys
						const seenBuySymbols = new Set();
						const topBuy = signalsWithScores
							.filter(s => s.action === 'buy' || s.buyScore >= s.sellScore)
							.sort((a, b) => b.buyScore - a.buyScore)
							.filter(s => {
								if (seenBuySymbols.has(s.symbol)) return false;
								seenBuySymbols.add(s.symbol);
								return true;
							})
							.slice(0, 3);
						
						// Get top 3 sells
						const seenSellSymbols = new Set();
						const topSell = signalsWithScores
							.filter(s => s.action === 'sell' || s.sellScore >= s.buyScore)
							.sort((a, b) => b.sellScore - a.sellScore)
							.filter(s => {
								if (seenSellSymbols.has(s.symbol)) return false;
								seenSellSymbols.add(s.symbol);
								return true;
							})
							.slice(0, 3);
						
						return { topBuy, topSell };
					} catch (error) {
						console.error('Error fetching signals:', error);
						return null;
					}
				}
				
				// Helper: Fetch catalog data
				async function fetchCatalog() {
					try {
						const response = await fetch('catalog-data.json');
						if (!response.ok) throw new Error('Failed to fetch catalog');
						return await response.json();
					} catch (error) {
						console.error('Error fetching catalog:', error);
						return null;
					}
				}

				// Helper: Build a compact, relevant catalog context for the worker
				function buildCatalogContext(catalog, message) {
					if (!Array.isArray(catalog) || catalog.length === 0) return null;
					const original = message || '';
					const lower = original.toLowerCase();

					let query = '';

					// 1) Prefer text in quotes: "Californication"
					const quoted = original.match(/"([^"]{2,80})"/);
					if (quoted) {
						query = quoted[1].toLowerCase();
					}

					// 2) Fallback: after "arrangement of ..."
					if (!query) {
						const m = original.match(/arrangement of\s+(.+?)(\?|$)/i);
						if (m) {
							query = m[1].toLowerCase();
						}
					}

					// 3) Trim generic suffixes like "by the Red Hot Chili Peppers"
					if (query.includes(' by ')) {
						// Keep both full query and the part before " by "
						const parts = query.split(' by ');
						// prefer the song title portion for direct matching
						query = parts[0].trim();
					}

					let filtered = catalog;

					if (query) {
						const q = query;
						filtered = catalog.filter(item => {
							const title = (item.title || '').toLowerCase();
							const composer = (item.composer || '').toLowerCase();
							return title.includes(q) || composer.includes(q);
						});

						// If no direct phrase match, fall back to word-based fuzzy match
						if (filtered.length === 0) {
							const words = q.split(/\s+/).filter(w => w.length > 3);
							if (words.length) {
								filtered = catalog.filter(item => {
									const title = (item.title || '').toLowerCase();
									const composer = (item.composer || '').toLowerCase();
									return words.some(w => title.includes(w) || composer.includes(w));
								});
							}
						}
					}

					// Hard cap to avoid huge prompts; keep first 80 relevant entries
					if (filtered.length > 80) {
						filtered = filtered.slice(0, 80);
					}

					return {
						type: 'catalog',
						songs: filtered.map(item => ({
							title: item.title,
							composer: item.composer,
							difficulty: item.difficulty,
							category: item.category,
							price: item.price,
							sheet_music_direct_url: item.sheet_music_direct_url || item.preview_url || null
						}))
					};
				}
				
				// Helper: Check if message is about signals
				function isSignalsQuery(text) {
					const t = text.toLowerCase();
					return t.includes('top') && (t.includes('buy') || t.includes('sell') || t.includes('signal'));
				}
				
				// Helper: Check if message is about catalog/songs
				function isCatalogQuery(text) {
					const t = text.toLowerCase();
					return t.includes('arrangement') || t.includes('song') || t.includes('catalog') || 
					       t.includes('do you have') || t.includes('available');
				}

				form.onsubmit = async function(e) {
					e.preventDefault();
					const message = (input.value || '').trim();
					if (!message) return;

					// Hide prompts after first message
					if (!prompts.classList.contains('hidden')) {
						prompts.classList.add('hidden');
					}

					input.value = '';
					sendBtn.disabled = true;
					sendBtn.textContent = 'Sending...';

					addMsg('You: ' + message, 'user');
					scrollToBottom();

					const loadingId = 'loading_' + Date.now();
					addMsg('Thinking...', 'loading');
					scrollToBottom();

					try {
						// Build context based on query type
						let contextData = null;
						const msgLower = message.toLowerCase();
						
						if (isSignalsQuery(message)) {
							const signalsData = await fetchTopSignals();
							if (signalsData) {
								contextData = {
									type: 'signals',
									topBuy: signalsData.topBuy.map(s => ({
										symbol: s.symbol,
										buyScore: s.buyScore,
										totalBuy: s.totalBuy,
										price: s.price,
										sector: s.sector,
										timestamp: s.timestamp
									})),
									topSell: signalsData.topSell.map(s => ({
										symbol: s.symbol,
										sellScore: s.sellScore,
										totalSell: s.totalSell,
										price: s.price,
										sector: s.sector,
										timestamp: s.timestamp
									}))
								};
							}
						} else if (isCatalogQuery(message)) {
							const catalog = await fetchCatalog();
							if (catalog) {
								contextData = buildCatalogContext(catalog, message);
							}
						}
						
						const requestBody = {
							message: message,
							sessionId: sessionId
						};
						
						if (contextData) {
							requestBody.context = contextData;
						}

						const response = await fetch(WORKER_ENDPOINT, {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
							},
							body: JSON.stringify(requestBody)
						});

						// Remove loading message
						const loadingMsg = msgs.querySelector('.chat-msg.loading');
						if (loadingMsg) loadingMsg.remove();

						if (!response.ok) {
							const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
							addMsg('Error: ' + (errorData.error || 'Failed to get response. Please try again.'), 'error');
							scrollToBottom();
							return;
						}

						const data = await response.json();
						let replyText = '';

						if (data.reply) {
							if (typeof data.reply === 'string') {
								replyText = data.reply;
							} else if (data.reply.answer_markdown) {
								replyText = data.reply.answer_markdown;
							} else if (data.reply.title) {
								replyText = data.reply.title + '\n\n' + (data.reply.answer_markdown || JSON.stringify(data.reply, null, 2));
							} else {
								replyText = JSON.stringify(data.reply, null, 2);
							}
						} else {
							replyText = 'No response received.';
						}

						addMsg(replyText, 'assistant');
						scrollToBottom();

					} catch (error) {
						const loadingMsg = msgs.querySelector('.chat-msg.loading');
						if (loadingMsg) loadingMsg.remove();

						console.error('Chat error:', error);
						addMsg('Error: Unable to connect to the assistant. Please check your connection and try again.', 'error');
						scrollToBottom();
					} finally {
						sendBtn.disabled = false;
						sendBtn.textContent = 'Send';
						input.focus();
					}
				};

				// Close on Escape key
				document.addEventListener('keydown', function(e) {
					if (e.key === 'Escape' && box.classList.contains('open')) {
						box.classList.remove('open');
					}
				});
			})();
		</script>
	</body>
</html>
